library(tidyverse)
library(lubridate)
library(patchwork)
library(ggridges)
library(ggrepel)
library(maps)
library(mmtable2)
library(gt)

# Source: https://www.bostonmagazine.com/property/single-family-home-prices/
massachusetts_median_house_2020 <- tibble::tribble(
               ~`City/Town`, ~`2019.Median.Price`, ~`2018.Median.Price`, ~`One-Year.%.Change.in.Price`, ~`Five-Year.%.Change.in.Price`, ~`Ten-Year.%.Change.in.Price`, ~`2019.DOM`, ~`2018.DOM`, ~`One-Year.Change`,
                 "Abington",           "$411,099",           "$395,000",                          "4%",                          "24%",                         "39%",         46L,         41L,              "12%",
                    "Acton",           "$640,932",           "$650,000",                         "-1%",                           "9%",                         "13%",         52L,         43L,              "21%",
                 "Amesbury",           "$448,377",           "$390,950",                         "15%",                          "34%",                         "33%",         52L,         52L,               "0%",
                  "Andover",           "$734,152",           "$663,000",                         "11%",                          "14%",                         "24%",         60L,         51L,              "18%",
                "Arlington",           "$893,616",           "$805,000",                         "11%",                         "155%",                         "72%",         28L,         21L,              "33%",
                    "Ashby",           "$296,438",           "$282,000",                          "5%",                          "33%",                         "45%",         72L,         62L,              "16%",
                  "Ashland",           "$512,857",           "$465,000",                         "10%",                          "24%",                         "44%",         35L,         32L,               "9%",
                "Attleboro",           "$364,267",           "$332,500",                         "10%",                          "31%",                         "35%",         49L,         51L,              "-4%",
                     "Avon",           "$359,318",           "$349,500",                          "3%",                          "32%",                         "48%",         43L,         45L,              "-4%",
                     "Ayer",           "$387,906",           "$360,000",                          "8%",                          "29%",                         "28%",         50L,         50L,               "0%",
                  "Bedford",           "$928,313",           "$729,000",                         "27%",                          "29%",                         "55%",         54L,         49L,              "10%",
               "Bellingham",           "$366,899",           "$337,000",                          "9%",                          "23%",                         "30%",         45L,         42L,               "7%",
                  "Belmont",         "$1,265,268",         "$1,160,000",                          "9%",                          "25%",                         "66%",         40L,         22L,              "82%",
                  "Beverly",           "$612,852",           "$468,200",                         "31%",                          "32%",                         "35%",         48L,         45L,               "7%",
                "Billerica",           "$485,370",           "$450,000",                          "8%",                          "31%",                         "48%",         47L,         40L,              "18%",
                   "Boston",           "$880,558",           "$615,000",                         "43%",                          "23%",                         "91%",         43L,         38L,              "13%",
               "Boxborough",           "$757,839",           "$675,000",                         "12%",                          "15%",                         "33%",         69L,         60L,              "15%",
                  "Boxford",           "$728,837",           "$687,500",                          "6%",                          "10%",                         "20%",         56L,        107L,             "-48%",
                "Braintree",           "$550,518",           "$498,000",                         "11%",                          "34%",                         "49%",         41L,         37L,              "11%",
              "Bridgewater",           "$410,547",           "$390,000",                          "5%",                          "25%",                         "31%",         67L,         51L,              "31%",
                 "Brockton",           "$319,682",           "$295,000",                          "8%",                          "49%",                         "81%",         45L,         44L,               "2%",
                "Brookline",         "$2,130,747",         "$1,777,500",                         "20%",                          "16%",                         "52%",         56L,         57L,              "-2%",
               "Burlington",           "$666,547",           "$583,000",                         "14%",                          "30%",                         "66%",         47L,         42L,              "12%",
                "Cambridge",         "$1,972,142",         "$1,400,000",                         "41%",                          "42%",                         "74%",         34L,         27L,              "26%",
                   "Canton",           "$636,600",           "$565,000",                         "13%",                          "19%",                         "32%",         52L,         47L,              "11%",
                 "Carlisle",         "$1,009,762",           "$875,000",                         "15%",                           "6%",                          "7%",         68L,         85L,             "-20%",
                   "Carver",           "$362,136",           "$345,000",                          "5%",                          "27%",                         "29%",         55L,         54L,               "2%",
               "Chelmsford",           "$484,580",           "$447,500",                          "8%",                          "23%",                         "35%",         44L,         38L,              "16%",
                  "Chelsea",           "$424,843",           "$450,500",                         "-6%",                          "56%",                        "123%",         46L,         38L,              "21%",
            "Chestnut Hill",         "$1,660,000",         "$1,315,000",                         "26%",                             NA,                            NA,          NA,          NA,                 NA,
                 "Cohasset",         "$1,175,774",           "$992,500",                         "18%",                          "25%",                         "27%",        100L,         95L,               "5%",
                  "Concord",         "$1,357,438",         "$1,041,000",                         "30%",                          "16%",                         "35%",         82L,         82L,               "0%",
                  "Danvers",           "$532,931",           "$467,000",                         "14%",                          "34%",                         "43%",         43L,         33L,              "30%",
                   "Dedham",           "$570,714",           "$517,000",                         "10%",                          "19%",                         "49%",         42L,         38L,              "11%",
                    "Dover",         "$1,620,059",         "$1,221,000",                         "33%",                          "29%",                         "31%",        143L,        129L,              "11%",
                   "Dracut",           "$407,127",           "$360,000",                         "13%",                          "34%",                         "38%",         38L,         42L,             "-10%",
                "Dunstable",           "$598,144",           "$572,450",                          "4%",                          "24%",                         "41%",         62L,         76L,             "-18%",
                  "Duxbury",           "$909,964",           "$680,000",                         "34%",                          "13%",                         "45%",         71L,         72L,              "-1%",
         "East Bridgewater",           "$387,582",           "$372,500",                          "4%",                          "28%",                         "34%",         50L,         55L,              "-9%",
                   "Easton",           "$535,623",           "$447,000",                         "20%",                          "18%",                         "34%",         74L,         61L,              "21%",
                    "Essex",           "$653,920",           "$551,000",                         "19%",                           "7%",                         "13%",         89L,         83L,               "7%",
                  "Everett",           "$458,518",           "$445,000",                          "3%",                          "56%",                         "95%",         37L,         38L,              "-3%",
               "Foxborough",           "$524,116",           "$450,000",                         "16%",                          "30%",                         "26%",         63L,         57L,              "11%",
               "Framingham",           "$489,110",           "$452,000",                          "8%",                          "29%",                         "48%",         38L,         28L,              "36%",
                 "Franklin",           "$503,124",           "$464,950",                          "8%",                          "15%",                         "17%",         50L,         47L,               "6%",
               "Georgetown",           "$510,271",           "$459,000",                         "11%",                          "15%",                         "15%",         45L,         45L,               "0%",
               "Gloucester",           "$647,847",           "$449,500",                         "44%",                          "15%",                         "35%",         76L,         66L,              "15%",
                   "Groton",           "$554,748",           "$530,000",                          "5%",                          "19%",                         "30%",         68L,        147L,             "-54%",
                "Groveland",           "$483,682",           "$430,000",                         "12%",                          "33%",                         "37%",         47L,         56L,             "-16%",
                  "Halifax",           "$674,563",           "$349,900",                         "93%",                         "117%",                        "121%",         67L,         43L,              "56%",
                 "Hamilton",           "$700,102",           "$602,450",                         "16%",                          "21%",                         "52%",         70L,         72L,              "-3%",
                  "Hanover",           "$593,513",           "$555,000",                          "7%",                          "25%",                         "41%",         50L,         67L,             "-25%",
                   "Hanson",           "$395,785",           "$372,000",                          "6%",                          "29%",                         "40%",         45L,         48L,              "-6%",
                  "Harvard",           "$645,438",           "$627,500",                          "3%",                           "5%",                         "20%",         88L,        110L,             "-20%",
                "Haverhill",           "$367,520",           "$338,000",                          "9%",                          "26%",                         "39%",         46L,         43L,               "7%",
                  "Hingham",         "$1,012,007",           "$820,000",                         "23%",                          "24%",                         "32%",         75L,         69L,               "9%",
                 "Holbrook",           "$368,874",           "$339,900",                          "9%",                          "35%",                         "55%",         39L,         38L,               "3%",
                "Holliston",           "$564,267",           "$485,000",                         "16%",                          "11%",                         "39%",         67L,         46L,              "46%",
                "Hopkinton",           "$710,558",           "$675,000",                          "5%",                          "16%",                         "34%",         66L,         77L,             "-14%",
                   "Hudson",           "$426,701",           "$378,000",                         "13%",                          "28%",                         "40%",         48L,         42L,              "14%",
                     "Hull",           "$543,017",           "$415,000",                         "31%",                          "28%",                         "37%",         68L,         62L,              "10%",
                  "Ipswich",           "$623,084",           "$540,250",                         "15%",                          "23%",                         "25%",         72L,         67L,               "7%",
                 "Kingston",           "$464,263",           "$430,000",                          "8%",                          "16%",                         "33%",         58L,         70L,             "-17%",
                "Lakeville",           "$407,539",           "$373,000",                          "9%",                          "21%",                         "42%",         77L,         54L,              "43%",
                 "Lawrence",           "$297,009",           "$280,000",                          "6%",                          "55%",                        "100%",         41L,         40L,               "3%",
                "Lexington",         "$1,345,932",         "$1,150,000",                         "17%",                          "19%",                         "75%",         51L,         37L,              "38%",
                  "Lincoln",         "$1,394,027",         "$1,250,000",                         "12%",                          "21%",                         "30%",         73L,         98L,             "-26%",
                "Littleton",           "$532,495",           "$570,250",                         "-7%",                          "16%",                         "29%",         56L,         63L,             "-11%",
                   "Lowell",           "$328,354",           "$300,000",                          "9%",                          "36%",                         "65%",         41L,         36L,              "14%",
                     "Lynn",           "$358,578",           "$350,000",                          "2%",                          "40%",                         "82%",         39L,         39L,               "0%",
                "Lynnfield",           "$733,180",           "$665,000",                         "10%",                          "18%",                         "23%",         42L,         52L,             "-19%",
                   "Malden",           "$495,967",           "$492,000",                          "1%",                          "50%",                         "81%",         34L,         25L,              "36%",
    "Manchester-by-the-Sea",         "$1,287,341",           "$924,000",                         "39%",                           "3%",                         "23%",        156L,        116L,              "34%",
                "Mansfield",           "$499,356",           "$450,000",                         "11%",                          "18%",                         "30%",         43L,         47L,              "-9%",
               "Marblehead",           "$899,628",           "$689,500",                         "30%",                          "13%",                         "44%",         60L,         63L,              "-5%",
              "Marlborough",           "$435,652",           "$391,000",                         "11%",                          "28%",                         "44%",         45L,         35L,              "29%",
               "Marshfield",           "$526,218",           "$450,000",                         "17%",                          "23%",                         "32%",         68L,         62L,              "10%",
                  "Maynard",           "$408,917",           "$382,100",                          "7%",                          "23%",                         "38%",         34L,         36L,              "-6%",
                 "Medfield",           "$771,780",           "$651,000",                         "19%",                          "10%",                         "18%",         62L,         53L,              "17%",
                  "Medford",           "$647,815",           "$617,000",                          "5%",                          "44%",                         "81%",         33L,         24L,              "38%",
                   "Medway",           "$474,998",           "$449,000",                          "6%",                          "16%",                         "23%",         47L,         54L,             "-13%",
                  "Melrose",           "$650,410",           "$650,000",                          "0%",                          "33%",                         "59%",         27L,         24L,              "13%",
                 "Merrimac",           "$443,711",           "$410,000",                          "8%",                           "9%",                         "31%",         48L,         56L,             "-14%",
                  "Methuen",           "$394,443",           "$360,000",                         "10%",                          "34%",                         "44%",         44L,         45L,              "-2%",
               "Middleboro",           "$367,854",           "$324,950",                         "13%",                          "40%",                         "35%",         65L,         56L,              "16%",
                "Middleton",           "$708,295",           "$627,500",                         "13%",                          "10%",                         "25%",         72L,         47L,              "53%",
                  "Milford",           "$369,220",           "$349,450",                          "6%",                          "26%",                         "27%",         44L,         42L,               "5%",
                   "Millis",           "$503,884",           "$420,000",                         "20%",                          "24%",                         "35%",         58L,         44L,              "32%",
                   "Milton",           "$863,602",           "$707,500",                         "22%",                          "35%",                         "63%",         47L,         56L,             "-16%",
                   "Nahant",           "$779,777",           "$580,000",                         "34%",                           "3%",                         "14%",         73L,        111L,             "-34%",
                   "Natick",           "$707,476",           "$625,000",                         "13%",                          "22%",                         "42%",         50L,         40L,              "25%",
                  "Needham",         "$1,223,843",         "$1,078,000",                         "14%",                          "26%",                         "51%",         54L,         44L,              "23%",
                  "Newbury",           "$633,633",           "$530,000",                         "20%",                          "24%",                         "43%",         71L,         87L,             "-18%",
              "Newburyport",           "$772,033",           "$612,450",                         "26%",                          "27%",                         "68%",         61L,         63L,              "-3%",
                   "Newton",         "$1,498,036",         "$1,205,000",                         "24%",                          "30%",                         "70%",         56L,         50L,              "12%",
                  "Norfolk",           "$612,505",           "$570,000",                          "7%",                          "25%",                         "32%",         78L,         53L,              "47%",
            "North Andover",           "$622,401",           "$590,000",                          "5%",                          "15%",                         "31%",         55L,         57L,              "-4%",
          "North Attleboro",           "$438,568",           "$380,000",                         "15%",                          "20%",                         "30%",         60L,         64L,              "-6%",
            "North Reading",           "$624,349",           "$555,000",                         "12%",                          "14%",                         "41%",         44L,         43L,               "2%",
                   "Norton",           "$381,890",           "$379,000",                          "1%",                          "25%",                         "17%",         51L,         55L,              "-7%",
                  "Norwell",           "$754,678",           "$637,500",                         "18%",                          "22%",                         "18%",         81L,         75L,               "8%",
                  "Norwood",           "$497,850",           "$475,000",                          "5%",                          "21%",                         "36%",         37L,         33L,              "12%",
                  "Peabody",           "$477,213",           "$445,000",                          "7%",                          "31%",                         "52%",         31L,         30L,               "3%",
                 "Pembroke",           "$450,072",           "$400,000",                         "13%",                          "24%",                         "30%",         62L,         72L,             "-14%",
                "Pepperell",           "$394,694",           "$350,000",                         "13%",                          "25%",                         "35%",         55L,         46L,              "20%",
               "Plainville",           "$484,634",           "$362,500",                         "34%",                          "38%",                         "31%",         51L,         54L,              "-6%",
                 "Plymouth",           "$434,085",           "$380,000",                         "14%",                          "23%",                         "34%",         73L,         72L,               "1%",
                 "Plympton",           "$450,083",           "$430,000",                          "5%",                          "35%",                         "47%",         67L,         77L,             "-13%",
                   "Quincy",           "$551,832",           "$493,750",                         "12%",                          "40%",                         "60%",         43L,         38L,              "13%",
                 "Randolph",           "$397,972",           "$375,000",                          "6%",                          "43%",                         "64%",         38L,         34L,              "12%",
                  "Raynham",           "$416,799",           "$420,500",                         "-1%",                          "19%",                         "22%",         55L,         57L,              "-4%",
                  "Reading",           "$663,028",           "$625,000",                          "6%",                          "28%",                         "53%",         40L,         35L,              "14%",
                   "Revere",           "$445,608",           "$435,500",                          "2%",                          "54%",                         "99%",         33L,         33L,               "0%",
                 "Rockland",           "$365,474",           "$340,000",                          "7%",                          "21%",                         "31%",         42L,         39L,               "8%",
                 "Rockport",           "$732,016",           "$625,000",                         "17%",                          "27%",                         "23%",         88L,         92L,              "-4%",
                   "Rowley",           "$549,730",           "$533,000",                          "3%",                          "19%",                         "30%",         57L,         45L,              "27%",
                    "Salem",           "$460,100",           "$425,000",                          "8%",                          "24%",                         "48%",         34L,         39L,             "-13%",
                "Salisbury",           "$412,952",           "$409,000",                          "1%",                          "12%",                         "29%",         45L,         75L,             "-40%",
                   "Saugus",           "$498,380",           "$445,000",                         "12%",                          "44%",                         "66%",         44L,         36L,              "22%",
                 "Scituate",           "$746,881",           "$589,500",                         "27%",                          "23%",                         "37%",         79L,         69L,              "14%",
                   "Sharon",           "$631,020",           "$530,000",                         "19%",                          "17%",                         "42%",         62L,         52L,              "19%",
                 "Sherborn",           "$944,120",           "$844,000",                         "12%",                           "7%",                         "20%",         87L,        115L,             "-24%",
                  "Shirley",           "$374,462",           "$378,500",                         "-1%",                          "15%",                         "46%",         50L,         53L,              "-6%",
               "Somerville",           "$940,318",           "$795,000",                         "18%",                          "52%",                        "119%",         30L,         36L,             "-17%",
                "Southboro",           "$729,325",           "$630,000",                         "16%",                          "17%",                         "47%",         71L,         56L,              "27%",
                 "Stoneham",           "$588,739",           "$560,000",                          "5%",                          "27%",                         "54%",         34L,         34L,               "0%",
                "Stoughton",           "$421,718",           "$380,000",                         "11%",                          "28%",                         "49%",         41L,         38L,               "8%",
                     "Stow",           "$573,925",           "$566,250",                          "1%",                          "15%",                         "11%",         81L,         57L,              "42%",
                  "Sudbury",           "$863,292",           "$749,950",                         "15%",                          "12%",                         "28%",         71L,         67L,               "6%",
               "Swampscott",           "$692,518",           "$580,000",                         "19%",                          "34%",                         "50%",         60L,         63L,              "-5%",
                  "Taunton",           "$330,697",           "$313,000",                          "6%",                          "35%",                         "36%",         46L,         49L,              "-6%",
                "Tewksbury",           "$471,953",           "$439,000",                          "8%",                          "26%",                         "40%",         38L,         36L,               "6%",
                "Topsfield",           "$674,803",           "$597,500",                         "13%",                          "11%",                         "29%",         66L,         63L,               "5%",
                 "Townsend",           "$322,861",           "$303,500",                          "6%",                          "34%",                         "30%",         68L,         51L,              "33%",
             "Tyngsborough",           "$435,171",           "$430,000",                          "1%",                          "17%",                         "25%",         53L,         36L,              "47%",
                "Wakefield",           "$591,357",           "$555,000",                          "7%",                          "26%",                         "32%",         34L,         30L,              "13%",
                  "Walpole",           "$603,158",           "$545,000",                         "11%",                          "16%",                         "36%",         48L,         45L,               "7%",
                  "Waltham",           "$659,229",           "$607,500",                          "9%",                          "36%",                         "53%",         37L,         32L,              "16%",
                "Watertown",           "$753,737",           "$670,000",                         "12%",                          "33%",                         "58%",         30L,         26L,              "15%",
                  "Wayland",           "$872,675",           "$787,000",                         "11%",                          "12%",                         "39%",         57L,         57L,               "0%",
                "Wellesley",         "$1,706,866",         "$1,437,500",                         "19%",                          "15%",                         "38%",         68L,         70L,              "-3%",
                   "Wenham",           "$782,134",           "$699,900",                         "12%",                          "13%",                         "12%",         86L,         94L,              "-9%",
         "West Bridgewater",           "$388,682",           "$369,000",                          "5%",                          "17%",                         "41%",         60L,         49L,              "22%",
             "West Newbury",           "$657,271",           "$553,650",                         "19%",                          "20%",                         "26%",         98L,         92L,               "7%",
                 "Westford",           "$613,840",           "$585,000",                          "5%",                          "15%",                         "36%",         56L,         45L,              "24%",
                   "Weston",         "$1,971,118",         "$1,537,500",                         "28%",                           "6%",                         "31%",        123L,        130L,              "-5%",
                 "Westwood",           "$922,704",           "$780,000",                         "18%",                          "17%",                         "43%",         66L,         58L,              "14%",
                 "Weymouth",           "$440,453",           "$410,000",                          "7%",                          "29%",                         "43%",         39L,         39L,               "0%",
                  "Whitman",           "$378,684",           "$330,500",                         "15%",                          "31%",                         "30%",         38L,         40L,              "-5%",
               "Wilmington",           "$566,849",           "$537,950",                          "5%",                          "33%",                         "48%",         43L,         39L,              "10%",
               "Winchester",         "$1,283,501",         "$1,189,500",                          "8%",                          "27%",                         "60%",         53L,         57L,              "-7%",
                 "Winthrop",           "$540,339",           "$523,000",                          "3%",                          "48%",                         "63%",         54L,         38L,              "42%",
                   "Woburn",           "$541,535",           "$499,950",                          "8%",                          "31%",                         "47%",         37L,         33L,              "12%",
                 "Wrentham",           "$561,535",           "$500,000",                         "12%",                          "19%",                         "27%",         79L,         52L,              "52%"
    )

# Source: https://www.bostonmagazine.com/property/top-places-to-live-2019-single-family-homes/
massachusetts_median_house_2019 <- tibble::tribble(
               ~`City/Town`, ~`2018.Median.Price`, ~`2017.Median.Price`, ~`2013.Median.Price`, ~`2008.Median.Price`, ~`One-Year.Change`, ~`Five-Year.Change`, ~`Ten-Year.Change`, ~`2018.Days.on.Market`, ~`2017.Days.on.Market`, ~`One-Year.Change`,
                 "Abington",           "$395,000",           "$374,950",           "$302,400",           "$308,000",               "5%",               "31%",              "28%",                    41L,                    43L,              "-5%",
                    "Acton",           "$650,000",           "$617,500",           "$521,000",           "$554,053",               "5%",               "25%",              "17%",                    43L,                    44L,              "-2%",
                 "Amesbury",           "$390,950",           "$365,250",           "$312,000",           "$269,000",               "7%",               "25%",              "45%",                    52L,                    51L,               "2%",
                  "Andover",           "$663,000",           "$639,900",           "$548,000",           "$529,900",               "4%",               "21%",              "25%",                    51L,                    54L,              "-6%",
                "Arlington",           "$805,000",           "$750,000",           "$565,000",           "$475,000",               "7%",               "42%",              "69%",                    21L,                    23L,              "-9%",
                    "Ashby",           "$282,000",           "$275,000",           "$216,000",           "$240,000",               "3%",               "31%",              "18%",                    62L,                    93L,             "-33%",
                  "Ashland",           "$465,000",           "$440,000",           "$359,000",           "$420,600",               "6%",               "30%",              "11%",                    32L,                    40L,             "-20%",
                "Attleboro",           "$332,500",           "$312,000",           "$250,000",           "$268,000",               "7%",               "33%",              "24%",                    51L,                    49L,               "4%",
                     "Avon",           "$349,500",           "$325,500",           "$265,000",           "$277,000",               "7%",               "32%",              "26%",                    45L,                    64L,             "-30%",
                     "Ayer",           "$360,000",           "$344,900",           "$320,000",           "$312,500",               "4%",               "13%",              "15%",                    50L,                    38L,              "32%",
                  "Bedford",           "$729,000",           "$711,000",           "$607,000",           "$541,000",               "3%",               "20%",              "35%",                    49L,                    48L,               "2%",
               "Bellingham",           "$337,000",           "$320,000",           "$264,250",           "$260,000",               "5%",               "28%",              "30%",                    42L,                    58L,             "-28%",
                  "Belmont",         "$1,160,000",         "$1,039,000",           "$806,000",           "$693,725",              "12%",               "44%",              "67%",                    22L,                    41L,             "-46%",
                  "Beverly",           "$468,200",           "$463,075",           "$360,000",           "$348,900",               "1%",               "30%",              "34%",                    45L,                    53L,             "-15%",
                "Billerica",           "$450,000",           "$430,000",           "$335,000",           "$315,000",               "5%",               "34%",              "43%",                    40L,                    37L,               "8%",
                   "Boston",           "$615,000",           "$580,000",           "$418,000",           "$349,000",               "6%",               "47%",              "76%",                    38L,                    43L,             "-12%",
               "Boxborough",           "$675,000",           "$622,500",           "$488,500",           "$625,000",               "8%",               "38%",               "8%",                    60L,                    63L,              "-5%",
                  "Boxford",           "$687,500",           "$636,500",           "$550,000",           "$549,900",               "8%",               "25%",              "25%",                   107L,                    93L,              "15%",
                "Braintree",           "$498,000",           "$473,000",           "$355,000",           "$342,500",               "5%",               "40%",              "45%",                    37L,                    37L,               "0%",
              "Bridgewater",           "$390,000",           "$375,500",           "$315,000",           "$319,250",               "4%",               "24%",              "22%",                    51L,                    51L,               "0%",
                 "Brockton",           "$295,000",           "$271,000",           "$179,900",           "$184,850",               "9%",               "64%",              "60%",                    44L,                    44L,               "0%",
                "Brookline",         "$1,777,500",         "$1,912,500",         "$1,350,000",         "$1,030,000",              "-7%",               "32%",              "73%",                    57L,                    67L,             "-15%",
               "Burlington",           "$583,000",           "$555,000",           "$420,000",           "$367,500",               "5%",               "39%",              "59%",                    42L,                    60L,             "-30%",
                "Cambridge",         "$1,400,000",         "$1,455,000",           "$903,000",           "$755,000",              "-4%",               "55%",              "85%",                    27L,                    32L,             "-16%",
                   "Canton",           "$565,000",           "$550,000",           "$465,000",           "$452,250",               "3%",               "22%",              "25%",                    47L,                    66L,             "-29%",
                 "Carlisle",           "$875,000",           "$858,000",           "$690,000",           "$777,500",               "2%",               "27%",              "13%",                    85L,                    76L,              "12%",
                   "Carver",           "$345,000",           "$315,000",           "$252,000",           "$275,000",              "10%",               "37%",              "25%",                    54L,                    63L,             "-14%",
               "Chelmsford",           "$447,500",           "$423,500",           "$343,350",           "$325,750",               "6%",               "30%",              "37%",                    38L,                    47L,             "-19%",
                  "Chelsea",           "$450,500",           "$371,000",           "$237,000",           "$195,000",              "21%",               "90%",             "131%",                    38L,                    27L,              "41%",
                 "Cohasset",           "$992,500",           "$945,000",           "$957,750",           "$725,000",               "5%",                "4%",              "37%",                    95L,                   129L,             "-26%",
                  "Concord",         "$1,041,000",         "$1,039,000",           "$881,000",           "$712,500",               "0%",               "18%",              "46%",                    82L,                    70L,              "17%",
                  "Danvers",           "$467,000",           "$449,000",           "$359,000",           "$359,000",               "4%",               "30%",              "30%",                    33L,                    43L,             "-23%",
                   "Dedham",           "$517,000",           "$486,000",           "$389,900",           "$360,000",               "6%",               "33%",              "44%",                    38L,                    43L,             "-12%",
                    "Dover",         "$1,221,000",         "$1,147,500",           "$883,000",         "$1,005,000",               "6%",               "38%",              "21%",                   129L,                   169L,             "-24%",
                   "Dracut",           "$360,000",           "$345,000",           "$265,000",           "$270,000",               "4%",               "36%",              "33%",                    42L,                    49L,             "-14%",
                "Dunstable",           "$572,450",           "$520,000",           "$405,000",           "$443,000",              "10%",               "41%",              "29%",                    76L,                    90L,             "-16%",
                  "Duxbury",           "$680,000",           "$671,000",           "$550,000",           "$643,000",               "1%",               "24%",               "6%",                    72L,                    88L,             "-18%",
         "East Bridgewater",           "$372,500",           "$347,500",           "$289,450",           "$290,451",               "7%",               "29%",              "28%",                    55L,                    52L,               "6%",
                   "Easton",           "$447,000",           "$447,000",           "$388,000",           "$356,500",               "0%",               "15%",              "25%",                    61L,                    66L,              "-8%",
                    "Essex",           "$551,000",           "$645,000",           "$467,500",           "$390,000",             "-15%",               "18%",              "41%",                    83L,                    80L,               "4%",
                  "Everett",           "$445,000",           "$409,950",           "$265,000",           "$250,000",               "9%",               "68%",              "78%",                    38L,                    36L,               "6%",
               "Foxborough",           "$450,000",           "$430,000",           "$358,000",           "$353,000",               "5%",               "26%",              "27%",                    57L,                    52L,              "10%",
               "Framingham",           "$452,000",           "$425,000",           "$338,250",           "$329,000",               "6%",               "34%",              "37%",                    28L,                    32L,             "-13%",
                 "Franklin",           "$464,950",           "$445,000",           "$355,000",           "$397,500",               "4%",               "31%",              "17%",                    47L,                    62L,             "-24%",
               "Georgetown",           "$459,000",           "$435,148",           "$386,250",           "$362,500",               "5%",               "19%",              "27%",                    45L,                    57L,             "-21%",
               "Gloucester",           "$449,500",           "$457,000",           "$343,000",           "$350,000",              "-2%",               "31%",              "28%",                    66L,                    83L,             "-20%",
                   "Groton",           "$530,000",           "$482,500",           "$405,000",           "$422,300",              "10%",               "31%",              "26%",                   147L,                    86L,              "71%",
                "Groveland",           "$430,000",           "$430,000",           "$329,000",           "$327,000",               "0%",               "31%",              "31%",                    56L,                    61L,              "-8%",
                  "Halifax",           "$349,900",           "$329,900",           "$270,000",           "$265,000",               "6%",               "30%",              "32%",                    43L,                    49L,             "-12%",
                 "Hamilton",           "$602,450",           "$549,900",           "$475,250",           "$471,000",              "10%",               "27%",              "28%",                    72L,                    86L,             "-16%",
                  "Hanover",           "$555,000",           "$500,000",           "$388,000",           "$395,000",              "11%",               "43%",              "41%",                    67L,                    75L,             "-11%",
                   "Hanson",           "$372,000",           "$355,000",           "$297,000",           "$295,000",               "5%",               "25%",              "26%",                    48L,                    51L,              "-6%",
                  "Harvard",           "$627,500",           "$637,500",           "$502,500",           "$584,573",              "-2%",               "25%",               "7%",                   110L,                   114L,              "-4%",
                "Haverhill",           "$338,000",           "$320,000",           "$261,000",           "$269,900",               "6%",               "30%",              "25%",                    43L,                    44L,              "-2%",
                  "Hingham",           "$820,000",           "$799,000",           "$650,000",           "$630,000",               "3%",               "26%",              "30%",                    69L,                    69L,               "0%",
                 "Holbrook",           "$339,900",           "$315,500",           "$243,250",           "$241,250",               "8%",               "40%",              "41%",                    38L,                    40L,              "-5%",
                "Holliston",           "$485,000",           "$465,750",           "$401,000",           "$350,000",               "4%",               "21%",              "39%",                    46L,                    69L,             "-33%",
                "Hopkinton",           "$675,000",           "$649,000",           "$556,510",           "$569,500",               "4%",               "21%",              "19%",                    77L,                    62L,              "24%",
                   "Hudson",           "$378,000",           "$359,900",           "$280,000",           "$285,000",               "5%",               "35%",              "33%",                    42L,                    38L,              "11%",
                     "Hull",           "$415,000",           "$420,500",           "$329,000",           "$345,000",              "-1%",               "26%",              "20%",                    62L,                    66L,              "-6%",
                  "Ipswich",           "$540,250",           "$551,250",           "$493,500",           "$415,000",              "-2%",                "9%",              "30%",                    67L,                    79L,             "-15%",
                 "Kingston",           "$430,000",           "$460,500",           "$351,250",           "$352,250",              "-7%",               "22%",              "22%",                    70L,                    90L,             "-22%",
                "Lakeville",           "$373,000",           "$355,000",           "$271,250",           "$324,500",               "5%",               "38%",              "15%",                    54L,                    67L,             "-19%",
                 "Lawrence",           "$280,000",           "$255,450",           "$180,000",           "$165,000",              "10%",               "56%",              "70%",                    40L,                    45L,             "-11%",
                "Lexington",         "$1,150,000",         "$1,150,000",           "$870,000",           "$749,950",               "0%",               "32%",              "53%",                    37L,                    56L,             "-34%",
                  "Lincoln",         "$1,250,000",         "$1,072,500",         "$1,117,000",           "$983,750",              "17%",               "12%",              "27%",                    98L,                   128L,             "-23%",
                "Littleton",           "$570,250",           "$488,000",           "$424,946",           "$400,000",              "17%",               "34%",              "43%",                    63L,                    58L,               "9%",
                   "Lowell",           "$300,000",           "$288,000",           "$215,500",           "$190,000",               "4%",               "39%",              "58%",                    36L,                    48L,             "-25%",
                     "Lynn",           "$350,000",           "$329,900",           "$226,000",           "$200,000",               "6%",               "55%",              "75%",                    39L,                    38L,               "3%",
                "Lynnfield",           "$665,000",           "$642,500",           "$535,000",           "$499,500",               "4%",               "24%",              "33%",                    52L,                    52L,               "0%",
                   "Malden",           "$492,000",           "$455,000",           "$310,000",           "$290,000",               "8%",               "59%",              "70%",                    25L,                    27L,              "-7%",
    "Manchester-by-the-Sea",           "$924,000",           "$866,500",           "$730,000",           "$775,000",               "7%",               "27%",              "19%",                   116L,                   123L,              "-6%",
                "Mansfield",           "$450,000",           "$450,000",           "$364,450",           "$391,750",               "0%",               "23%",              "15%",                    47L,                    50L,              "-6%",
               "Marblehead",           "$689,500",           "$662,500",           "$526,500",           "$484,500",               "4%",               "31%",              "42%",                    63L,                    72L,             "-13%",
              "Marlborough",           "$391,000",           "$360,000",           "$291,500",           "$302,600",               "9%",               "34%",              "29%",                    35L,                    52L,             "-33%",
               "Marshfield",           "$450,000",           "$470,000",           "$374,000",           "$379,900",              "-4%",               "20%",              "18%",                    62L,                    71L,             "-13%",
                  "Maynard",           "$382,100",           "$385,000",           "$320,000",           "$311,000",              "-1%",               "19%",              "23%",                    36L,                    41L,             "-12%",
                 "Medfield",           "$651,000",           "$681,000",           "$575,000",           "$597,500",              "-4%",               "13%",               "9%",                    53L,                    64L,             "-17%",
                  "Medford",           "$617,000",           "$597,000",           "$409,000",           "$356,500",               "3%",               "51%",              "73%",                    24L,                    25L,              "-4%",
                   "Medway",           "$449,000",           "$408,000",           "$373,000",           "$352,500",              "10%",               "20%",              "27%",                    54L,                    46L,              "17%",
                  "Melrose",           "$650,000",           "$617,000",           "$433,750",           "$400,250",               "5%",               "50%",              "62%",                    24L,                    29L,             "-17%",
                 "Merrimac",           "$410,000",           "$432,450",           "$324,000",           "$398,500",              "-5%",               "27%",               "3%",                    56L,                    82L,             "-32%",
                  "Methuen",           "$360,000",           "$342,000",           "$254,000",           "$265,000",               "5%",               "42%",              "36%",                    45L,                    44L,               "2%",
               "Middleboro",           "$324,950",           "$299,000",           "$250,000",           "$283,000",               "9%",               "30%",              "15%",                    56L,                    67L,             "-16%",
                "Middleton",           "$627,500",           "$645,000",           "$524,900",           "$405,000",              "-3%",               "20%",              "55%",                    47L,                    62L,             "-24%",
                  "Milford",           "$349,450",           "$331,000",           "$275,000",           "$265,750",               "6%",               "27%",              "31%",                    42L,                    46L,              "-9%",
                   "Millis",           "$420,000",           "$450,000",           "$340,000",           "$335,250",              "-7%",               "24%",              "25%",                    44L,                    63L,             "-30%",
                   "Milton",           "$707,500",           "$646,500",           "$500,000",           "$450,000",               "9%",               "42%",              "57%",                    56L,                    46L,              "22%",
                   "Nahant",           "$580,000",           "$674,500",           "$455,000",           "$387,500",             "-14%",               "27%",              "50%",                   111L,                   103L,               "8%",
                   "Natick",           "$625,000",           "$600,000",           "$460,000",           "$420,000",               "4%",               "36%",              "49%",                    40L,                    46L,             "-13%",
                  "Needham",         "$1,078,000",           "$989,018",           "$805,000",           "$659,000",               "9%",               "34%",              "64%",                    44L,                    56L,             "-21%",
                  "Newbury",           "$530,000",           "$495,000",           "$384,000",           "$410,000",               "7%",               "38%",              "29%",                    87L,                    65L,              "34%",
              "Newburyport",           "$612,450",           "$627,500",           "$505,000",           "$452,000",              "-2%",               "21%",              "35%",                    63L,                    76L,             "-17%",
                   "Newton",         "$1,205,000",         "$1,200,000",           "$910,000",           "$755,000",               "0%",               "32%",              "60%",                    50L,                    47L,               "6%",
                  "Norfolk",           "$570,000",           "$555,000",           "$450,000",           "$472,000",               "3%",               "27%",              "21%",                    53L,                    73L,             "-27%",
            "North Andover",           "$590,000",           "$570,000",           "$487,200",           "$509,750",               "4%",               "21%",              "16%",                    57L,                    55L,               "4%",
          "North Attleboro",           "$380,000",           "$374,000",           "$345,000",           "$320,000",               "2%",               "10%",              "19%",                    64L,                    64L,               "0%",
            "North Reading",           "$555,000",           "$548,000",           "$462,000",           "$441,250",               "1%",               "20%",              "26%",                    43L,                    49L,             "-12%",
                   "Norton",           "$379,000",           "$369,900",           "$275,000",           "$330,000",               "2%",               "38%",              "15%",                    55L,                    54L,               "2%",
                  "Norwell",           "$637,500",           "$669,000",           "$582,500",           "$560,000",              "-5%",                "9%",              "14%",                    75L,                    83L,             "-10%",
                  "Norwood",           "$475,000",           "$440,000",           "$360,000",           "$359,900",               "8%",               "32%",              "32%",                    33L,                    43L,             "-23%",
                  "Peabody",           "$445,000",           "$414,000",           "$321,750",           "$319,500",               "7%",               "38%",              "39%",                    30L,                    37L,             "-19%",
                 "Pembroke",           "$400,000",           "$370,000",           "$326,250",           "$348,500",               "8%",               "23%",              "15%",                    72L,                    54L,              "33%",
                "Pepperell",           "$350,000",           "$375,000",           "$285,000",           "$310,000",              "-7%",               "23%",              "13%",                    46L,                    69L,             "-33%",
               "Plainville",           "$362,500",           "$421,025",           "$350,000",           "$380,000",             "-14%",                "4%",              "-5%",                    54L,                    58L,              "-7%",
                 "Plymouth",           "$380,000",           "$350,000",           "$290,000",           "$305,000",               "9%",               "31%",              "25%",                    72L,                    87L,             "-17%",
                 "Plympton",           "$430,000",           "$400,000",           "$313,000",           "$311,000",               "8%",               "37%",              "38%",                    77L,                    85L,              "-9%",
                   "Quincy",           "$493,750",           "$450,000",           "$353,500",           "$333,000",              "10%",               "40%",              "48%",                    38L,                    49L,             "-22%",
                 "Randolph",           "$375,000",           "$352,260",           "$240,000",           "$256,500",               "6%",               "56%",              "46%",                    34L,                    42L,             "-19%",
                  "Raynham",           "$420,500",           "$376,500",           "$293,500",           "$299,750",              "12%",               "43%",              "40%",                    57L,                    67L,             "-15%",
                  "Reading",           "$625,000",           "$597,500",           "$460,000",           "$400,000",               "5%",               "36%",              "56%",                    35L,                    31L,              "13%",
                   "Revere",           "$435,500",           "$376,500",           "$259,900",           "$242,000",              "16%",               "68%",              "80%",                    33L,                    42L,             "-21%",
                 "Rockland",           "$340,000",           "$318,000",           "$237,500",           "$258,500",               "7%",               "43%",              "32%",                    39L,                    32L,              "22%",
                 "Rockport",           "$625,000",           "$558,750",           "$525,000",           "$415,300",              "12%",               "19%",              "50%",                    92L,                    88L,               "5%",
                   "Rowley",           "$533,000",           "$511,500",           "$399,900",           "$440,000",               "4%",               "33%",              "21%",                    45L,                    65L,             "-31%",
                    "Salem",           "$425,000",           "$381,750",           "$310,000",           "$298,000",              "11%",               "37%",              "43%",                    39L,                    42L,              "-7%",
                "Salisbury",           "$409,000",           "$370,000",           "$280,000",           "$274,500",              "11%",               "46%",              "49%",                    75L,                    61L,              "23%",
                   "Saugus",           "$445,000",           "$415,000",           "$310,750",           "$300,000",               "7%",               "43%",              "48%",                    36L,                    35L,               "3%",
                 "Scituate",           "$589,500",           "$576,500",           "$475,000",           "$459,000",               "2%",               "24%",              "28%",                    69L,                    97L,             "-29%",
                   "Sharon",           "$530,000",           "$515,900",           "$487,000",           "$365,000",               "3%",                "9%",              "45%",                    52L,                    60L,             "-13%",
                 "Sherborn",           "$844,000",           "$825,000",           "$745,000",           "$710,000",               "2%",               "13%",              "19%",                   115L,                   114L,               "1%",
                  "Shirley",           "$378,500",           "$386,950",           "$275,000",           "$359,500",              "-2%",               "38%",               "5%",                    53L,                    78L,             "-32%",
               "Somerville",           "$795,000",           "$733,750",           "$549,350",           "$399,750",               "8%",               "45%",              "99%",                    36L,                    28L,              "29%",
                "Southboro",           "$630,000",           "$570,000",           "$530,650",           "$492,000",              "11%",               "19%",              "28%",                    56L,                    69L,             "-19%",
                 "Stoneham",           "$560,000",           "$537,500",           "$410,000",           "$385,000",               "4%",               "37%",              "45%",                    34L,                    41L,             "-17%",
                "Stoughton",           "$380,000",           "$372,000",           "$300,000",           "$285,000",               "2%",               "27%",              "33%",                    38L,                    40L,              "-5%",
                     "Stow",           "$566,250",           "$520,000",           "$436,000",           "$505,000",               "9%",               "30%",              "12%",                    57L,                    67L,             "-15%",
                  "Sudbury",           "$749,950",           "$735,000",           "$680,000",           "$604,000",               "2%",               "10%",              "24%",                    67L,                    76L,             "-12%",
               "Swampscott",           "$580,000",           "$530,000",           "$435,500",           "$415,000",               "9%",               "33%",              "40%",                    63L,                    57L,              "11%",
                  "Taunton",           "$313,000",           "$285,000",           "$227,500",           "$252,025",              "10%",               "38%",              "24%",                    49L,                    46L,               "7%",
                "Tewksbury",           "$439,000",           "$425,000",           "$320,000",           "$320,000",               "3%",               "37%",              "37%",                    36L,                    36L,               "0%",
                "Topsfield",           "$597,500",           "$600,000",           "$480,000",           "$480,000",               "0%",               "24%",              "24%",                    63L,                    78L,             "-19%",
                 "Townsend",           "$303,500",           "$288,000",           "$225,000",           "$259,500",               "5%",               "35%",              "17%",                    51L,                    69L,             "-26%",
             "Tyngsborough",           "$430,000",           "$399,000",           "$346,500",           "$359,900",               "8%",               "24%",              "19%",                    36L,                    61L,             "-41%",
                "Wakefield",           "$555,000",           "$520,000",           "$418,500",           "$383,250",               "7%",               "33%",              "45%",                    30L,                    35L,             "-14%",
                  "Walpole",           "$545,000",           "$492,000",           "$437,500",           "$383,000",              "11%",               "25%",              "42%",                    45L,                    45L,               "0%",
                  "Waltham",           "$607,500",           "$582,000",           "$438,000",           "$396,000",               "4%",               "39%",              "53%",                    32L,                    34L,              "-6%",
                "Watertown",           "$670,000",           "$644,500",           "$480,000",           "$419,000",               "4%",               "40%",              "60%",                    26L,                    26L,               "0%",
                  "Wayland",           "$787,000",           "$700,000",           "$612,025",           "$505,000",              "12%",               "29%",              "56%",                    57L,                    63L,             "-10%",
                "Wellesley",         "$1,437,500",         "$1,380,000",         "$1,126,500",         "$1,102,000",               "4%",               "28%",              "30%",                    70L,                    93L,             "-25%",
                   "Wenham",           "$699,900",           "$545,000",           "$469,500",           "$441,000",              "28%",               "49%",              "59%",                    94L,                    59L,              "59%",
         "West Bridgewater",           "$369,000",           "$366,000",           "$296,250",           "$277,550",               "1%",               "25%",              "33%",                    49L,                    60L,             "-18%",
             "West Newbury",           "$553,650",           "$552,450",           "$467,000",           "$472,500",               "0%",               "19%",              "17%",                    92L,                    88L,               "5%",
                 "Westford",           "$585,000",           "$565,000",           "$460,000",           "$438,000",               "4%",               "27%",              "34%",                    45L,                    65L,             "-31%",
                   "Weston",         "$1,537,500",         "$1,395,000",         "$1,235,750",         "$1,327,500",              "10%",               "24%",              "16%",                   130L,                   137L,              "-5%",
                 "Westwood",           "$780,000",           "$727,500",           "$620,000",           "$489,950",               "7%",               "26%",              "59%",                    58L,                    74L,             "-22%",
                 "Weymouth",           "$410,000",           "$395,000",           "$299,000",           "$298,000",               "4%",               "37%",              "38%",                    39L,                    43L,              "-9%",
                  "Whitman",           "$330,500",           "$331,450",           "$248,500",           "$255,000",               "0%",               "33%",              "30%",                    40L,                    36L,              "11%",
               "Wilmington",           "$537,950",           "$490,500",           "$372,250",           "$355,000",              "10%",               "45%",              "52%",                    39L,                    43L,              "-9%",
               "Winchester",         "$1,189,500",         "$1,100,000",           "$874,668",           "$731,575",               "8%",               "36%",              "63%",                    57L,                    51L,              "12%",
                 "Winthrop",           "$523,000",           "$475,000",           "$328,000",           "$326,500",              "10%",               "59%",              "60%",                    38L,                    36L,               "6%",
                   "Woburn",           "$499,950",           "$472,500",           "$360,000",           "$330,000",               "6%",               "39%",              "52%",                    33L,                    37L,             "-11%",
                 "Wrentham",           "$500,000",           "$478,000",           "$448,358",           "$425,000",               "5%",               "12%",              "18%",                    52L,                    79L,             "-34%"
    )


massachusetts_median_house_2020 <- massachusetts_median_house_2020 %>%
    transmute(
        city = factor(`City/Town` %>% str_to_lower() %>% str_trim()),
        med_2019 = parse_number(`2019.Median.Price`),
        med_2018 = parse_number(`2018.Median.Price`)
    )

massachusetts_median_house_2019 <- massachusetts_median_house_2019 %>%
    select(`City/Town`, `2017.Median.Price`, `2013.Median.Price`, `2008.Median.Price`) %>%
    transmute(
        city = factor(`City/Town` %>% str_to_lower() %>% str_trim()),
        med_2017 = parse_number(`2017.Median.Price`),
        med_2013 = parse_number(`2013.Median.Price`),
        med_2008 = parse_number(`2008.Median.Price`)
    )

massachusetts_median_house <- massachusetts_median_house_2020 %>%
    left_join(massachusetts_median_house_2019, by = "city") %>%
    mutate(pct_chg = 100.0 * (med_2019 / med_2013)) %>%
    mutate(city = factor(city) %>% fct_reorder(pct_chg) %>% fct_rev())

massachusetts_cities_tbl <- us.cities %>%
    filter(country.etc == "MA") %>%
    mutate(name = name %>%
               str_sub(end = nchar(name) - 3) %>%
               str_to_lower() %>%
               str_trim()
    ) %>%
    left_join(massachusetts_median_house, by = c("name" = "city"))

massachusetts_outline_tbl <- map_data("state", region = "massachusetts") %>% as_tibble() %>%
    filter(subregion == "main") %>%
    filter(long >= -72.0)

gg_ma_map <- massachusetts_cities_tbl %>%
    drop_na() %>%
    ggplot(aes(x = long, y = lat, size = pct_chg)) +
    geom_polygon(
        data  = massachusetts_outline_tbl,
        aes(x = long, y = lat, group = group, size = NULL),
        color = "black",
        size = 1.5,
        fill = "#18bc9c"
    ) +
    geom_point() +
    geom_text_repel(aes(label = str_to_title(name)), max.overlaps = 9) +
    # scale_color_viridis_c() +
    coord_map() +
    theme_void() +
    labs(title = "Greater Boston Median Home Prices", subtitle = "2013-2019 Percent Change by City", x = "", y = "") +
    theme(legend.position = "none")

show(gg_ma_map)
